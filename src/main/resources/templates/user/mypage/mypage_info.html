<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorate="~{user/mypage/mypage_layout}">
<head>
    <meta charset="UTF-8">
    <title>My Page</title>
</head>
<body style="background-color: #f8f9fa">
<div layout:fragment="mypage-content">
    <h3 class="my-3 border-bottom pb-2">프로필 편집</h3>

    <div class="mypage-profile">
        <form>
            <img id="mypage-profile-img" class="mypage-profile-img" th:if="${user.profileImage == null}"
                 src="/static/image/anonymous_profile.png">
            <img class="mypage-profile-img" th:unless="${user.profileImage == null}" th:src="${user.profileImage}">
            <input class="form-control d-none" type="file" accept="image/*" id="editFile" onchange="editProfile()">
            <div class="mt-2">
                <label for="editFile">
                    <span class="mypage-profile-edit" onclick="editProfile()">프로필 편집</span>
                </label>
            </div>
            <div class="form-group row mt-5 justify-content-center">
                <label for="inputUserName" class="col-sm-1 col-form-label">닉네임</label>
                <div class="col-sm-3">
                    <input type="text" class="form-control" id="inputUserName" th:placeholder="${user.username}">
                </div>
            </div>
            <div class="mt-5 mb-5">
                <button type="button" class="btn btn-success me-3" id="btn-submit" onclick="updateInfo()">수정하기</button>
                <button type="reset" class="btn btn-secondary" id="btn-reset" onclick="resetInfo()">취소하기</button>
            </div>
        </form>
    </div>

    <script type="text/javascript" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript">
        var originImage = "/static/image/anonymous_profile.png";

        let profileImage = document.getElementById("mypage-profile-img");
        if (profileImage) {
            originImage = profileImage.src;
        }

        function editProfile() {
            const fileInput = document.getElementById("editFile");
            const selectedFile = fileInput.files[0];
            let updateImage = document.getElementsByClassName("mypage-profile-img")[0];

            const fileReader = new FileReader();
            fileReader.onload = e => {
                updateImage.src = e.target.result;
            }

            fileReader.readAsDataURL(selectedFile);
        }
    </script>
</div>
</body>
</html>