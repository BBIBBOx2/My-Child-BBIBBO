<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.w3.org/1999/xhtml"
      layout:decorate="~{layout}">
<head>
    <meta charset="UTF-8">
    <title>Hospital List</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" th:href="@{/static/bootstrap.min.css}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        function toggleAdditionalInfo(button) {
            var cardText = button.parentNode;
            var additionalInfo = cardText.querySelector("#additional-info");

            if (additionalInfo.style.display === "none") {
                additionalInfo.style.display = "block";
                button.textContent = "접기";
            } else {
                additionalInfo.style.display = "none";
                button.textContent = "자세히 보기";
            }
        }
        // var $ = jQuery.noConflict();
        $(document).ready(function() {

            // 라디오 버튼 변경 시 이벤트 핸들러
            $('input[name="formality"]').change(function() {
                var value = $(this).val();
                var url = value === 'map' ? '/hospital' : '/hospital/list';
                window.location.href = url;
            });

            $('#regionSelect').on('change', function() {
                var selectedRegionName = $(this).val();
                console.log('Selected region: ' + selectedRegionName);
                window.location.href = "/hospital/list?regionName="+selectedRegionName;
            });

            $('#Design').change(function() {
                var selectedRegionName = $('#regionSelect').val();
                var isERChecked = $(this).is(':checked');

                if (isERChecked) {
                    console.log('운영 중인 응급실이 체크되었습니다.');
                    window.location.href = "/hospital/list?regionName=" + selectedRegionName + "&isERChecked=" + isERChecked;
                } else {
                    console.log('운영 중인 응급실이 체크 해제되었습니다.');
                    window.location.href = "/hospital/list?regionName=" + selectedRegionName;
                }
            });

// URL의 쿼리 파라미터에서 체크 상태 읽어와서 설정
            var urlParams = new URLSearchParams(window.location.search);
            var isERChecked = urlParams.get('isERChecked');
            if (isERChecked === 'true') {
                $('#Design').prop('checked', true);
            }
        });
    </script>
</head>
<body>
<div layout:fragment="content">
    <div class="container my-3">
        <div class="content-container">
            <h5 class="border-bottom py-2">전국 실시간 병원 조회</h5>
            <div class="mb-3">
                <div style="float:left; margin-top: 3px">
                    <select id="regionSelect" class="form-select" style="margin-right: 10px; " aria-label="Default select example">
                        <option selected th:unless="${regionName}" hidden="hidden">시군구 선택</option>
                        <option th:each="region : ${regions}"
                                th:value="${region.id}"
                                th:text="${region.name}"
                                th:selected="${region.id} == ${regionName}"></option>
                    </select>
                </div>
                <div style="float: right">
                    <div class="form_toggle">
                        <div style="margin-top: 5px; margin-right: 10px; margin-bottom:-10px">
                            <svg class="tick-icon">
                                <symbol id="check-tick" viewbox="0 0 12 10">
                                    <polyline points="1.5 6 4.5 9 10.5 1"></polyline>
                                </symbol>
                            </svg>
                            <input class="main" id="Design" type="checkbox" style="display: none;"/>
                            <label class="inside-label" for="Design"><span>
                  <svg width="12px" height="10px">
              <use xlink:href="#check-tick"></use>
                 </svg></span><span style="font-size: small">운영 중인 응급실</span></label>
                        </div>
                        <div class="form_radio_btn" style="width:40px">
                            <input id="radio-1" type="radio" name="formality" value="map">
                            <label for="radio-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="currentColor" class="bi bi-geo-alt-fill" style="margin-top:-5px" viewBox="0 0 16 16">
                                    <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                                </svg>
                            </label>
                        </div>
                        <div class="form_radio_btn" style="width:40px">
                            <input id="radio-2" type="radio" name="formality" value="list" checked>
                            <label for="radio-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" style="margin-top:-5px" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
                                </svg>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="hospital-list-container">
                <div th:each="hospital : ${hospitalList}">
                    <div class="card my-3">
                        <div class="card-body">
                            <div class="position-relative">
                                <div style="padding-top: 1%" class="review-content-area mt-0 mb-4">
                                    <div class="card-text">
                                        <div class="fw-bolder strong mt-2" th:text="${hospital.name}"></div>
                                        <p class="text-end m-0" th:text="${hospital.address}" style="font-size: 0.8rem; color: gray;"></p>
                                        <p class="fw-bolder mb-0 content-nickname" th:if="${hospital.isErOperating == 1}">응급실 운영</p>
                                        <p class="fw-bolder content-nickname" style="margin-bottom:8px" th:if="${hospital.isErOperating == 2}">응급실 미운영</p>
                                        <p style="font-size: small; margin-bottom: 0px" th:text="${hospital.getInfo()}"></p>
                                        <p style="font-size: small" th:text="${hospital.getEtc()}"></p>
                                        <p id="additional-info" style="display: none;">test</p>
                                        <button class="btn btn-success btn-sm" style="float:right" onclick="toggleAdditionalInfo(this)">자세히 보기</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>